# ğŸŒ AWS EKS Traffic Flow & Internet Connectivity Guide

## ğŸš€ Complete Traffic Flow Architecture

```
                                    ğŸŒ INTERNET
                                        â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚     INTERNET GATEWAY (IGW)            â”‚
                    â”‚    igw-0e74bf1068b4cd3dd              â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                    VPC ROUTE TABLE                          â”‚
        â”‚              Route: 0.0.0.0/0 â†’ IGW                        â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          VPC: leadertools-qas-vpc                              â”‚
â”‚                        Primary: 10.142.32.0/21                                â”‚
â”‚                        Secondary: 100.96.32.0/21                              â”‚
â”‚                                                                                â”‚
â”‚   PUBLIC SUBNETS                    â”‚                    PRIVATE SUBNETS      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚   PUBLIC AZ-A       â”‚           â”‚           â”‚   KUBERNETES AZ-A       â”‚   â”‚
â”‚   â”‚ 10.142.39.0/25      â”‚           â”‚           â”‚  10.142.36.0/24         â”‚   â”‚
â”‚   â”‚ subnet-0de9b50b...  â”‚           â”‚           â”‚  subnet-06582423...     â”‚   â”‚
â”‚   â”‚                     â”‚           â”‚           â”‚                         â”‚   â”‚
â”‚   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚           â”‚           â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚   â”‚ â”‚  NAT Gateway    â”‚ â”‚           â”‚           â”‚ â”‚   EKS Nodes         â”‚ â”‚   â”‚
â”‚   â”‚ â”‚  (if exists)    â”‚ â”‚           â”‚           â”‚ â”‚   ALB Controllers   â”‚ â”‚   â”‚
â”‚   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚           â”‚           â”‚ â”‚   16 x ALBs         â”‚ â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚           â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚   â”‚   PUBLIC AZ-B       â”‚           â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ 10.142.39.128/25    â”‚           â”‚           â”‚   KUBERNETES AZ-B       â”‚   â”‚
â”‚   â”‚ subnet-03597db2...  â”‚           â”‚           â”‚  10.142.37.0/24         â”‚   â”‚
â”‚   â”‚                     â”‚           â”‚           â”‚  subnet-090a8b74...     â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                     â”‚                                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                    AVIATRIX GATEWAY ROUTING                            â”‚   â”‚
â”‚   â”‚                                                                        â”‚   â”‚
â”‚   â”‚  Gateway Instance 1: i-0919b0c12ffebfc98 (Primary)                   â”‚   â”‚
â”‚   â”‚  Gateway Instance 2: i-022003229928b80a1 (Secondary)                 â”‚   â”‚
â”‚   â”‚                                                                        â”‚   â”‚
â”‚   â”‚  Corporate Networks:                                                   â”‚   â”‚
â”‚   â”‚  â€¢ 208.75.8.0/24, 208.75.9.x/32, 208.75.11.x/32, 208.75.12.x/32    â”‚   â”‚
â”‚   â”‚  â€¢ 64.47.4.88/32, 64.47.5.24/32, 64.47.12.0/26                      â”‚   â”‚
â”‚   â”‚  â€¢ 198.168.10.0/24, 185.60.31.64/26, 80.241.66.64/26               â”‚   â”‚
â”‚   â”‚  â€¢ RFC 1918: 10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16             â”‚   â”‚
â”‚   â”‚  â€¢ Other VPCs: 100.96.16.0/21, 100.96.24.0/21, etc.                 â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                                â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                          POD NETWORK TIER                              â”‚   â”‚
â”‚   â”‚                                                                        â”‚   â”‚
â”‚   â”‚  AZ-A Pod Subnet: 100.96.32.0/22 (subnet-09d92cbf937adefe5)          â”‚   â”‚
â”‚   â”‚  AZ-B Pod Subnet: 100.96.36.0/22 (subnet-0282b6517b060ced4)          â”‚   â”‚
â”‚   â”‚                                                                        â”‚   â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚   â”‚
â”‚   â”‚  â”‚   Pod 1      â”‚  â”‚   Pod 2      â”‚  â”‚   Pod N      â”‚                 â”‚   â”‚
â”‚   â”‚  â”‚100.96.32.10  â”‚  â”‚100.96.32.11  â”‚  â”‚100.96.36.20  â”‚                 â”‚   â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                                â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                      EKS CONTROL PLANE                                 â”‚   â”‚
â”‚   â”‚              Service CIDR: 172.20.0.0/16                              â”‚   â”‚
â”‚   â”‚      API Endpoint: Public Access (HTTPS:443)                          â”‚   â”‚
â”‚   â”‚   F1DF92535C71913009EBF4096328D6A1.gr7.us-west-2.eks.amazonaws.com   â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Traffic Flow Patterns

### **1. Internet Inbound Traffic (External Users â†’ Applications)**

```
ğŸŒ Internet Users
    â”‚ HTTPS:443
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Internet Gateway            â”‚
â”‚      igw-0e74bf1068b4cd3dd          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Public Subnet Route Table     â”‚
â”‚    Route: 0.0.0.0/0 â†’ IGW          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Application Load Balancers      â”‚
â”‚     (16 x Internal ALBs)            â”‚
â”‚   â€¢ CrownPeak: internal-k8s-...     â”‚
â”‚   â€¢ RankTracker: internal-k8s-...   â”‚
â”‚   â€¢ PO3 Apps: internal-k8s-...      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚ Target Group Health Checks
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         EKS Worker Nodes            â”‚
â”‚    NodePort/ClusterIP Services     â”‚
â”‚      10.142.36.0/24 (AZ-A)         â”‚
â”‚      10.142.37.0/24 (AZ-B)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚ Pod-to-Pod via CNI
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Application Pods            â”‚
â”‚      100.96.32.0/22 (AZ-A)         â”‚
â”‚      100.96.36.0/22 (AZ-B)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **2. Outbound Traffic (Pods â†’ Internet)**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Application Pods            â”‚
â”‚   Pod IPs: 100.96.32.0/22          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚ Source NAT to Node IP
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         EKS Worker Nodes            â”‚
â”‚   Node IPs: 10.142.36.0/24         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        Route Table Decision         â”‚
â”‚                                     â”‚
â”‚  IF destination = Corporate:        â”‚
â”‚     â†’ Aviatrix Gateway              â”‚
â”‚  ELSE:                              â”‚
â”‚     â†’ Internet Gateway              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â”œâ”€ Corporate Traffic â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                  â–¼
    â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                    â”‚     Aviatrix Gateways       â”‚
    â”‚                    â”‚  i-0919b0c12ffebfc98 (Pri)  â”‚
    â”‚                    â”‚  i-022003229928b80a1 (Sec)  â”‚
    â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚                                  â”‚
    â”‚                                  â–¼
    â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                    â”‚      Corporate Networks     â”‚
    â”‚                    â”‚   â€¢ 208.75.x.x ranges      â”‚
    â”‚                    â”‚   â€¢ 64.47.x.x ranges       â”‚
    â”‚                    â”‚   â€¢ RFC 1918 networks      â”‚
    â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â””â”€ Internet Traffic â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                      â–¼
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚       Internet Gateway     â”‚
                        â”‚    igw-0e74bf1068b4cd3dd    â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚         ğŸŒ Internet         â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **3. EKS Control Plane Communication**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       EKS Worker Nodes              â”‚
â”‚     kubelet, kube-proxy             â”‚
â”‚    10.142.36.0/24, 10.142.37.0/24  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚ HTTPS:443, 10250, 6443
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Security Groups             â”‚
â”‚  sg-0da734f201fa4ca64 (Cluster)    â”‚
â”‚  sg-07019a3af3f18cfa1 (Nodes)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        EKS Control Plane            â”‚
â”‚     (AWS Managed Service)           â”‚
â”‚   Public Endpoint: ENABLED         â”‚
â”‚   Private Endpoint: DISABLED        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **4. Pod-to-Pod Communication (CNI Custom Networking)**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Pod A (AZ-A)               â”‚
â”‚        100.96.32.10                 â”‚
â”‚     subnet-09d92cbf937adefe5        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚ Direct Pod-to-Pod via VPC CNI
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Pod B (AZ-B)               â”‚
â”‚        100.96.36.20                 â”‚
â”‚     subnet-0282b6517b060ced4        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Note: Pods get IPs from dedicated pod subnets,
      separate from node IPs for better isolation
```

---

## ğŸ›¤ï¸ Routing Tables Explained

### **Main Route Table (rtb-0af593cb336560f42)**
```
Destination              Target                    Purpose
10.142.32.0/21          local                     Primary VPC CIDR
100.96.32.0/21          local                     Secondary VPC CIDR (Pods)

Corporate Routes (via Aviatrix Gateway):
208.75.9.40/32          i-0919b0c12ffebfc98      doTERRA Corporate
208.75.11.75/32         i-022003229928b80a1      Corporate Backup Route
64.47.4.88/32           i-0919b0c12ffebfc98      External Partner
192.168.0.0/16          i-0919b0c12ffebfc98      RFC 1918 Private
172.16.0.0/12           i-0919b0c12ffebfc98      RFC 1918 Private
10.0.0.0/8              i-0919b0c12ffebfc98      RFC 1918 Private

Internet Route:
0.0.0.0/0               i-0919b0c12ffebfc98      Default via Aviatrix
```

### **Public Subnet Route Table (rtb-0f638339c9e32354e)**
```
Destination              Target                    Purpose
10.142.32.0/21          local                     Primary VPC CIDR
100.96.32.0/21          local                     Secondary VPC CIDR
0.0.0.0/0               igw-0e74bf1068b4cd3dd     Direct Internet Access
```

### **Public Subnet Route Table (rtb-0c706da088d700de3)**
```
Associated with Public Subnets:
- subnet-0de9b50b551f454d0 (Public AZ-A)
- subnet-03597db27bc94efd6 (Public AZ-B)

Routes include both Aviatrix and direct IGW routing
for hybrid connectivity patterns
```

---

## ğŸ” Security Groups Flow

### **Traffic Flow Through Security Groups**

```
Internet â†’ ALB Security Groups â†’ Node Security Groups â†’ Pod Network Policies

1. ALB Security Groups (16 groups):
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  Inbound: 443 â† 0.0.0.0/0        â”‚
   â”‚  Outbound: ALL â†’ 0.0.0.0/0       â”‚
   â”‚  Examples:                       â”‚
   â”‚  â€¢ sg-092ea2ae08df86c55           â”‚
   â”‚  â€¢ sg-0370741c2e987fb22           â”‚
   â”‚  â€¢ sg-064225f82ef9578e6           â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
2. EKS Cluster Security Group:
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  sg-0da734f201fa4ca64             â”‚
   â”‚  All traffic within cluster      â”‚
   â”‚  (Auto-created by EKS)           â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
3. Node Security Groups:
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  sg-07019a3af3f18cfa1             â”‚
   â”‚  API Server: 443, 6443, 8443     â”‚
   â”‚  Kubelet: 10250                  â”‚
   â”‚  CoreDNS: 53                     â”‚
   â”‚  NodePort: 30000-32767           â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ Key Interview Talking Points

### **1. Why This Complex Routing?**
```
Q: "Why not use standard VPC routing?"
A: "doTERRA has hybrid cloud requirements:
   - Corporate networks accessible via Aviatrix gateways
   - Specific routes for different business units
   - Compliance requirements for traffic inspection
   - High availability with primary/secondary gateway instances"
```

### **2. CNI Custom Networking Benefits**
```
Q: "Explain the pod networking design"
A: "We implemented CNI custom networking because:
   - Separates pod IPs (100.96.32.0/21) from node IPs (10.142.36.0/24)
   - Enables prefix delegation for ~110 pods per node vs ~17 traditional
   - Better security isolation between infrastructure and applications
   - Supports 2000+ concurrent pods across the cluster"
```

### **3. Load Balancer Strategy**
```
Q: "Why 16 different load balancers?"
A: "Application isolation and microservices architecture:
   - Each application stack gets its own ALB
   - Separate security groups per application
   - Independent scaling and SSL termination
   - Blue/green deployments without cross-impact"
```

### **4. Internet Gateway vs Aviatrix Routing**
```
Q: "When does traffic use which path?"
A: "Smart routing based on destination:
   - Internet traffic â†’ IGW (public subnets only)
   - Corporate networks â†’ Aviatrix gateways
   - RFC 1918 addresses â†’ Aviatrix for hybrid connectivity
   - Default route â†’ Aviatrix (security inspection required)"
```

### **5. High Availability Design**
```
Q: "How do you ensure no single points of failure?"
A: "Multi-layer redundancy:
   - EKS control plane spans 3 AZs automatically
   - Worker nodes in 2 AZs with auto-scaling
   - Dual Aviatrix gateways (primary/secondary)
   - ALBs automatically span multiple AZs
   - Pod subnets in both AZs for CNI redundancy"
```

---

## ğŸš¨ Troubleshooting Traffic Flow

### **Pod Cannot Reach Internet**
```bash
# Check CNI configuration
kubectl describe configmap aws-node -n kube-system

# Verify ENIConfig
kubectl get eniconfig

# Check route tables
aws ec2 describe-route-tables --route-table-ids rtb-0af593cb336560f42

# Test connectivity from pod
kubectl exec -it <pod-name> -- curl -v google.com
```

### **ALB Health Check Failures**
```bash
# Check target group health
aws elbv2 describe-target-health --target-group-arn <arn>

# Verify security group rules
aws ec2 describe-security-groups --group-ids sg-092ea2ae08df86c55

# Check NodePort service
kubectl get svc -o wide
```

### **Corporate Network Connectivity Issues**
```bash
# Check Aviatrix gateway status
aws ec2 describe-instances --instance-ids i-0919b0c12ffebfc98

# Verify route table entries
aws ec2 describe-route-tables --filters "Name=route.destination-cidr-block,Values=208.75.9.40/32"

# Test from EKS node
kubectl debug node/<node-name> -it --image=busybox
```

---

This detailed traffic flow diagram shows exactly how connections work in your AWS EKS environment, making it perfect for explaining the architecture in interviews! ğŸ¯